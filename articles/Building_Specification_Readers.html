<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Building Specification Readers • metacore</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building Specification Readers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metacore</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Building_Specification_Readers.html">Building Specification Readers</a></li>
    <li><a class="dropdown-item" href="../articles/Example.html">Example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/atorus-research/metacore/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Building Specification Readers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atorus-research/metacore/blob/main/vignettes/Building_Specification_Readers.Rmd" class="external-link"><code>vignettes/Building_Specification_Readers.Rmd</code></a></small>
      <div class="d-none name"><code>Building_Specification_Readers.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atorus-research.github.io/metacore/">metacore</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Attaching package `metacore`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; As of metacore 0.3.0 the `keep` variable in the `ds_vars` table has been renamed to `mandatory`. Please see release documentation for details.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<p>The first thing to do when trying to build a specification reader is
to try the default. By default metacore can read in specifications that
are in the Pinnacle 21 specification format. If your document isn’t in
that format, it is still worth trying the default readers, as the error
messages can be helpful.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spec_to_metacore.html">spec_to_metacore</a></span><span class="op">(</span><span class="fu"><a href="../reference/metacore_example.html">metacore_example</a></span><span class="op">(</span><span class="st">"mock_spec.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `create_tbl()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Unable to rename the following columns in Domains</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> label matches 2 columns: c("Label", "Description")</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please check your regular expression</span></span></code></pre></div>
<p>As we can see, the mock spec we are using here doesn’t match the
format. Therefore we will have to build a bespoke reader. Before we
start, it is important to understand the structure of the metacore
object. Each object acts as its own database for all dataset related
metadata. The object has 7 tables and their general purpose are as
follows:</p>
<ul>
<li><p><strong>ds_spec</strong>: Contains dataset level
information</p></li>
<li><p><strong>ds_vars</strong>: Bridges the dataset and variable level
information</p></li>
<li><p><strong>var_spec</strong>: Contains variable level
information</p></li>
<li><p><strong>value_spec</strong>: Contains value level
information</p></li>
<li><p><strong>derivations</strong>: Contains all derivations</p></li>
<li><p><strong>codelist</strong>: Contains information about
code/decodes, permitted values and external libraries</p></li>
<li><p><strong>supp</strong>: Contains information specific to
supplemental variables</p></li>
</ul>
<p>Here is a schema of how all this fits together</p>
<div class="float">
<img src="../reference/figures/labeled_schema.png" title="Metacore Schema" alt="Schema diagram showing the relationships between all metacore tables"><div class="figcaption">Schema diagram showing the relationships between
all metacore tables</div>
</div>
<p>ds_spec is connected to ds_vars by the ‘dataset’ variable and ds_vars
is connected to var_spec by the ‘variable’ variable, etc. For more
information on the make-up of metacore objects please see the
README.</p>
<p>Now that we understand what makes a metacore object, we can start to
develop the reader.</p>
<p>First, we need to identify what type of specification format you
have. At the moment we support a specification where each tab contains
information relevant to a different table, such as a domain tab, a
variable tab, etc. To test this you can use the <code>spec_type</code>
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">metacore</span><span class="fu">:::</span><span class="fu"><a href="../reference/spec_type.html">spec_type</a></span><span class="op">(</span><span class="fu"><a href="../reference/metacore_example.html">metacore_example</a></span><span class="op">(</span><span class="st">"mock_spec.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "by_type"</span></span></code></pre></div>
<p>Given we have the type style of specification, we can attempt to run
with the lower level built-in specification to metacore build. There are
6 lower level specification builders to match each of the 6 datasets
needed, spec_type_to_*. Even if these fail, the error messages should
help identify the issues.</p>
<p>But, before we start any of that, we need to read in our document
using the <code>read_all_sheets</code> function. This function reads in
a multisheet excel file into a named list, where the name of each
dataset is the name of the tab. The lower level specification builders
do assume the provided <code>doc</code> is a named list. This mock
specification has 5 tabs, domain, variables, value level metadata,
controlled terms, and computational method. So it looks like we might
need to split the information in these tabs to get the 6 tables needed
for the metacore object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_all_sheets.html">read_all_sheets</a></span><span class="op">(</span><span class="fu"><a href="../reference/metacore_example.html">metacore_example</a></span><span class="op">(</span><span class="st">"mock_spec.xlsx"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">doc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">head</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Domains</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">#&gt;   `Domain Name` Label    Repeating `Is Reference?` Class Source `Data Structure`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADDS          Disposi… Y         N               BDS   DS     One record per …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADRACE        Race An… Y         N               OTHER DM, S… One record per …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADTRT         Treatme… Y         N               OTHER ADSL   One record per …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADSL          Subject… N         N               ADSL  <span style="color: #BB0000;">NA</span>     One record per …</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: `Key Variables` &lt;chr&gt;, Description &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Documentation &lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Variables</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 18</span></span></span>
<span><span class="co">#&gt;   `Domain Name` `Therapeutic Area` Indication `Variable Name` Label        Type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADAE          CORE               CORE       STUDYID         Study Ident… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADAE          CORE               CORE       USUBJID         Unique Subj… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADAE          CORE               CORE       SUBJID          Subject Ide… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADAE          CORE               CORE       SITEID          Study Site … Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ADAE          CORE               CORE       AGE             Age          Inte…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ADAE          CORE               CORE       SEX             Sex          Text </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: `Max Length` &lt;chr&gt;, `Variable Order` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Mandatory &lt;chr&gt;, `Signficant Digits` &lt;chr&gt;, `Sort Order` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Required &lt;chr&gt;, Origin &lt;chr&gt;, `Value Level Metadata` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Controlled Term or Format` &lt;chr&gt;, `Computational Method` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Definition / Comments` &lt;chr&gt;, `Additional Information` &lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Value_level_Metadata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 13</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 variables: VLM Name &lt;chr&gt;, Therapeutic Area &lt;chr&gt;, Indication &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Parameter Code &lt;chr&gt;, Parameter &lt;chr&gt;, Type &lt;chr&gt;, Max Length &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Signficant Digits &lt;chr&gt;, Origin &lt;chr&gt;, Controlled Term &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Computational Method &lt;chr&gt;, Mandatory &lt;chr&gt;, Definition/Comments &lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Controlled_Terms</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   `Codelist Name` `Codelist Code` `Coded Value`           Description / Decode…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SEX             SEX             F                       Female                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SEX             SEX             M                       Male                  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SEX             SEX             U                       Unknown               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> RACE            RACE            BLACK OR AFRICAN AMERI… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> RACE            RACE            AMERICAN INDIAN OR ALA… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> RACE            RACE            ASIAN                   <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​`Description / Decoded Value`</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: `Code Info` &lt;chr&gt;, `Extension?` &lt;chr&gt;, Rank &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Source &lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Computational_Method</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   `Computational Method Name` `Definition / Comments`     Additional Informati…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRTP                        Compare ADT/ASTDT to the s… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRTA                        Compare ADT/ASTDT to the s… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> TPERIOD                     Latest value of APERIOD fr… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> TPERADY                     Contains the number of day… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TPERSTDY                    Contains the number of day… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TPERENDY                    Contains the number of day… <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​`Additional Information`</span></span></span></code></pre></div>
<p>Let’s start with making the ds_spec (dataset specification) table
using <code>spec_type_to_ds_spec</code>. The ds_spec table is made of 3
columns: the dataset name, the dataset structure, and the dataset label.
If we look at our specification document, it looks like all this
information is in the Domains tab. Now we know what we need, we can
start building the table by trying the <code>spec_type_to_ds_spec</code>
function.</p>
<p>This function takes in our named list of datasets (doc), a named
vector of columns (cols) and a sheet name (sheet). But, only doc is
needed, the other inputs have defaults. So we can try with just the
default and see what we get.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spec_type_to_ds_spec.html">spec_type_to_ds_spec</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `create_tbl()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Unable to rename the following columns in Domains</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> label matches 2 columns: c("Label", "Description")</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please check your regular expression</span></span></code></pre></div>
<p>The error tells us there is an issue with the label column in the
Domains table. Meaning, we need to change the default vector for the
cols input because the default regular expression isn’t specific enough.
First, let’s check the column names in the Domain tab</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span><span class="op">$</span><span class="va">Domains</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Domain Name"    "Label"          "Repeating"      "Is Reference?" </span></span>
<span><span class="co">#&gt;  [5] "Class"          "Source"         "Data Structure" "Key Variables" </span></span>
<span><span class="co">#&gt;  [9] "Description"    "Documentation"</span></span></code></pre></div>
<p>If we look at the default input for cols,
<code>"label" = "[L|l]abel|[D|d]escription"</code>, we can see the label
is matching to the <code>Label</code> and the <code>Description</code>
columns .</p>
<p>We only need the Domain <code>Name</code>, <code>Label</code>, and
<code>Data Structure</code> columns. So we can update the expressions to
be more specific.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_ds_spec.html">spec_type_to_ds_spec</a></span><span class="op">(</span><span class="va">doc</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"Name"</span>,</span>
<span>    <span class="st">"structure"</span> <span class="op">=</span> <span class="st">"Data Structure"</span>,</span>
<span>    <span class="st">"label"</span> <span class="op">=</span> <span class="st">"Label"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ds_spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   dataset structure                                                    label    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADDS    One record per subject per datetime per parameter per result Disposit…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADRACE  One record per subject per analysis sequence number          Race Ana…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADTRT   One record per subject per period                            Treatmen…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADSL    One record per subject                                       Subject-…</span></span></code></pre></div>
<p>Regular expressions are used to match the columns, so if you needed a
more flexible input, you could do that. Now, we have the ds_spec table
we can move on to the ds_vars table.</p>
<p>The ds_vars table has 7 columns:</p>
<ul>
<li><p>dataset: dataset name</p></li>
<li><p>variable: variable name</p></li>
<li><p>key_seq: integers controlling the sort order of each
dataset</p></li>
<li><p>order: integer controlling the column order of each
dataset</p></li>
<li><p>mandatory: from Define-XML v2.1. A Boolean value indicating if
NULL values are permitted. <code>mandatory = TRUE</code> indicates that
NULL values are not permitted.</p></li>
<li><p>core: ADaM core (Expected, Required, Permissible)</p></li>
<li><p>supp_flag: boolean to determine if the variable is in the
supplementals</p></li>
</ul>
<p>When we look back at our specification document we can see all this
information is in the variable tab. The inputs for the
<code>spec_type_to_ds_vars</code> function are the same as before, but
with slightly different defaults. By default ds_vars only checks sheets
labeled “Variable” (this is because all the settings are defaulted to
read in P21 formatted specs). But, those default work for our
specifications cause all the information is in the variable tab; so we
can try with just the defaults again.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spec_type_to_ds_vars.html">spec_type_to_ds_vars</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `create_tbl()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Unable to rename the following columns in Variables</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> variable matches 2 columns: c("Variable Name", "Variable Order")</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> order matches 2 columns: c("Variable Order", "Sort Order")</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please check your regular expression</span></span></code></pre></div>
<p>This error means it is trying to match the sheet entitled Variable,
the variable column matches to two different columns. This is the same
error we had before. We just need to have a quick look at the columns
and adjust the regular expression to be more specific. Additionally, for
the key sequence variable isn’t in the variable tab. We saw this
information above in the domain tab. So we will need to do two things to
fix this. First, adjust the dataset name in the
<code>key_seq_cols</code> argument. Second, change the sheets to include
the variable and the domain sheet.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span><span class="op">$</span><span class="va">Variables</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 18</span></span></span>
<span><span class="co">#&gt;   `Domain Name` `Therapeutic Area` Indication `Variable Name` Label        Type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADAE          CORE               CORE       STUDYID         Study Ident… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADAE          CORE               CORE       USUBJID         Unique Subj… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADAE          CORE               CORE       SUBJID          Subject Ide… Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADAE          CORE               CORE       SITEID          Study Site … Text </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ADAE          CORE               CORE       AGE             Age          Inte…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ADAE          CORE               CORE       SEX             Sex          Text </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: `Max Length` &lt;chr&gt;, `Variable Order` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Mandatory &lt;chr&gt;, `Signficant Digits` &lt;chr&gt;, `Sort Order` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Required &lt;chr&gt;, Origin &lt;chr&gt;, `Value Level Metadata` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Controlled Term or Format` &lt;chr&gt;, `Computational Method` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Definition / Comments` &lt;chr&gt;, `Additional Information` &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="va">ds_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_ds_vars.html">spec_type_to_ds_vars</a></span><span class="op">(</span><span class="va">doc</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"Domain"</span>,</span>
<span>    <span class="st">"variable"</span> <span class="op">=</span> <span class="st">"[V|v]ariable [N|n]ame"</span>,</span>
<span>    <span class="st">"order"</span> <span class="op">=</span> <span class="st">"[V|v]ariable [O|o]rder"</span>,</span>
<span>    <span class="st">"mandatory"</span> <span class="op">=</span> <span class="st">"[M|m]andatory"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  key_seq_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"Domain Name"</span>,</span>
<span>    <span class="st">"key_seq"</span> <span class="op">=</span> <span class="st">"Key"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sheet <span class="op">=</span> <span class="st">"[V|v]ar|Domains"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ds_vars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   dataset variable order mandatory key_seq core  supp_flag</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADAE    STUDYID     10 TRUE           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADAE    USUBJID     20 TRUE           <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADAE    SUBJID      25 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADAE    SITEID      30 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ADAE    AGE         40 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ADAE    SEX         50 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>The next table we have is var_spec, the table of variable level
metadata. var_spec is separate from ds_vars because, in accordance with
CDISC standards, labels and lengths should be the same for a given
variable across all datasets. So, we are able to normalize the data to
only have one row per variable, which ensures this rule and helps reduce
the size of the object. There are 6 columns in var_spec:</p>
<ul>
<li><p>variable: variable name</p></li>
<li><p>length: variable length</p></li>
<li><p>label: variable label</p></li>
<li><p>type: variable Class</p></li>
<li><p>format: variable format</p></li>
<li><p>common: boolean if variable is common across ADaM</p></li>
</ul>
<p>Looking back at our specification we see this will also be built
using the Variable tab. So, we know we need to edit the regular
expression for the variable to make it more specific. Additionally, if
you look at the default for <code>cols</code> you see there is a dataset
input. This is because some standards aren’t 100% consistent, some
variables (e.g. visit) have different lengths depending on the dataset.
<strong>So to accommodate this some of the variables in var_spec are in
the ds.variable format</strong>. These builders will do this conversion
for you , but the dataset is needed. The other thing the builders can
automatically deal with is the common variable. If given a dataset
column, the builder function will automatically figure out which
variables are common to all dataset. This is good because we don’t have
a common variable in our specs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_var_spec.html">spec_type_to_var_spec</a></span><span class="op">(</span><span class="va">doc</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"variable"</span> <span class="op">=</span> <span class="st">"Variable Name"</span>,</span>
<span>  <span class="st">"length"</span> <span class="op">=</span> <span class="st">"[L|l]ength"</span>,</span>
<span>  <span class="st">"label"</span> <span class="op">=</span> <span class="st">"[L|l]abel"</span>,</span>
<span>  <span class="st">"type"</span> <span class="op">=</span> <span class="st">"[T|t]ype"</span>,</span>
<span>  <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"[D|d]ataset|[D|d]omain"</span>,</span>
<span>  <span class="st">"format"</span> <span class="op">=</span> <span class="st">"Format"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   variable length label                            type    format common</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> STUDYID       9 Study Identifier                 Text    <span style="color: #BB0000;">NA</span>     TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> USUBJID      30 Unique Subject Identifier        Text    <span style="color: #BB0000;">NA</span>     TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SUBJID       20 Subject Identifier for the Study Text    <span style="color: #BB0000;">NA</span>     FALSE </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SITEID       10 Study Site Identifier            Text    <span style="color: #BB0000;">NA</span>     TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> AGE           8 Age                              Integer <span style="color: #BB0000;">NA</span>     TRUE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> SEX           1 Sex                              Text    SEX    TRUE</span></span></code></pre></div>
<p>There is one issue here: the format column is also the codelist
names. This is because the information came from the “Controlled Term or
Format” column of my spec document. So the final step of preparing
var_spec table is to remove the controlled terms. It is easy here
because all the formats end in a full stop (.), but the controlled terms
don’t.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_spec</span> <span class="op">&lt;-</span> <span class="va">var_spec</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">format</span>, <span class="st">"\\."</span><span class="op">)</span>, <span class="va">format</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The next dataset is value_spec, which contains the value level
metadata. It is made up of 8 columns:</p>
<ul>
<li><p>dataset: dataset name</p></li>
<li><p>variable: variable name</p></li>
<li><p>origin: origin of data</p></li>
<li><p>type: value type</p></li>
<li><p>sig_dig: significant digits of the value</p></li>
<li><p>code_id: id used to cross-reference the code/decode</p></li>
<li><p>where: value of the variable</p></li>
<li><p>derivation_id: id used to cross-reference the derivation</p></li>
</ul>
<p>By default, <code>spec_type_to_value_spec</code> is set up to have
the where information on a different sheet because that is the format of
a P21 spec, but in our spec we don’t have that. In fact, we don’t have
any value level metadata in our spec. But, that is fine - the default
builders will just pull what information it can from the variable tab.
Additionally this spec doesn’t have a predecessor column, so we can just
use the method column.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">value_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_value_spec.html">spec_type_to_value_spec</a></span><span class="op">(</span><span class="va">doc</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"VLM Name|Domain"</span>,</span>
<span>    <span class="st">"variable"</span> <span class="op">=</span> <span class="st">"VLM Name|Variable Name"</span>,</span>
<span>    <span class="st">"origin"</span> <span class="op">=</span> <span class="st">"[O|o]rigin"</span>,</span>
<span>    <span class="st">"type"</span> <span class="op">=</span> <span class="st">"[T|t]ype"</span>,</span>
<span>    <span class="st">"code_id"</span> <span class="op">=</span> <span class="st">"Controlled Term"</span>,</span>
<span>    <span class="st">"where"</span> <span class="op">=</span> <span class="st">"Parameter Code"</span>,</span>
<span>    <span class="st">"derivation_id"</span> <span class="op">=</span> <span class="st">"Method"</span>,</span>
<span>    <span class="st">"predecessor"</span> <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  where_sep_sheet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">value_spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   dataset variable origin      type    code_id derivation_id where sig_dig</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ADAE    STUDYID  Predecessor Text    <span style="color: #BB0000;">NA</span>      pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ADAE    USUBJID  Predecessor Text    <span style="color: #BB0000;">NA</span>      pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ADAE    SUBJID   Predecessor Text    <span style="color: #BB0000;">NA</span>      pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ADAE    SITEID   Predecessor Text    <span style="color: #BB0000;">NA</span>      pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ADAE    AGE      Predecessor Integer <span style="color: #BB0000;">NA</span>      pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ADAE    SEX      Predecessor Text    SEX     pred.NA       TRUE       <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>The derivation table is relatively simple by comparison. It just has
two columns, the derivation id and the derivation. But, the derivation
comes from the supplied derivation, predecessor, or comment column
depending on the origin. In this mock we don’t have a predecessor column
so we can set to comment as well.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">derivation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_derivations.html">spec_type_to_derivations</a></span><span class="op">(</span><span class="va">doc</span>,</span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"derivation_id"</span> <span class="op">=</span> <span class="st">"Name"</span>,</span>
<span>    <span class="st">"derivation"</span> <span class="op">=</span> <span class="st">"[D|d]efinition|[D|d]escription"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  var_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"dataset"</span> <span class="op">=</span> <span class="st">"Domain Name"</span>,</span>
<span>    <span class="st">"variable"</span> <span class="op">=</span> <span class="st">"Variable Name|VLM"</span>,</span>
<span>    <span class="st">"origin"</span> <span class="op">=</span> <span class="st">"[O|o]rigin"</span>,</span>
<span>    <span class="st">"predecessor"</span> <span class="op">=</span> <span class="st">"Comment"</span>,</span>
<span>    <span class="st">"comment"</span> <span class="op">=</span> <span class="st">"Comment"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">derivation</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   derivation_id derivation                                                      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRTP          Compare ADT/ASTDT to the series of ADSL.APxxSDT and ADSL.APxxED…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRTA          Compare ADT/ASTDT to the series of ADSL.APxxSDT and ADSL.APxxED…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> TPERIOD       Latest value of APERIOD from ADTRT where ADTRT.TRSDT/ADTRT.TRSD…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> TPERADY       Contains the number of days from the first exposure date in the…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TPERSTDY      Contains the number of days from the first exposure date in the…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TPERENDY      Contains the number of days from the first exposure date in the…</span></span></code></pre></div>
<p>The final table is codelist. This table contains all the code/decode
pairs, all lists of permitted values and information about external
libraries. What is somewhat special about the structure of this table is
there isn’t just a code and a decode column, but rather a codes column
that contains a list of code/decode tables, permitted value vectors and
external dictionary vectors. So there is one row per code (i.e. a row
for country and one for yes/no codes etc.). This structure makes it
easier to see all the codes at once and allows some code to be numeric
and others to be character.</p>
<p>By default the <code>spec_type_to_codelist</code> function expects
codelists and external dictionaries. But, in the specification we only
have codelist so <code>dict_cols</code> needs to be set to null.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spec_type_to_codelist.html">spec_type_to_codelist</a></span><span class="op">(</span><span class="va">doc</span>,</span>
<span>  codelist_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"code_id"</span> <span class="op">=</span> <span class="st">"Codelist Code"</span>,</span>
<span>    <span class="st">"name"</span> <span class="op">=</span> <span class="st">"Codelist Name"</span>,</span>
<span>    <span class="st">"code"</span> <span class="op">=</span> <span class="st">"Coded Value"</span>,</span>
<span>    <span class="st">"decode"</span> <span class="op">=</span> <span class="st">"Decoded Value"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  simplify <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dict_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">codelist</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   code_id name    type        codes           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SEX     SEX     code_decode <span style="color: #949494;">&lt;tibble [3 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> RACE    RACE    code_decode <span style="color: #949494;">&lt;tibble [5 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> COUNTRY COUNTRY code_decode <span style="color: #949494;">&lt;tibble [2 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> NY      NY      code_decode <span style="color: #949494;">&lt;tibble [2 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> DATEFL  DATEFL  code_decode <span style="color: #949494;">&lt;tibble [2 × 2]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AESEV   AESEV   code_decode <span style="color: #949494;">&lt;tibble [3 × 2]&gt;</span></span></span></code></pre></div>
<p>Now we have all the tables we need we can make the metacore
object</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/metacore.html">metacore</a></span><span class="op">(</span><span class="va">ds_spec</span>, <span class="va">ds_vars</span>, <span class="va">var_spec</span>, <span class="va">value_spec</span>,</span>
<span>  <span class="va">derivation</span>, <span class="va">codelist</span>,</span>
<span>  verbose <span class="op">=</span> <span class="st">"message"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `core` from the `ds_vars` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `supp_flag` from the `ds_vars` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `sig_dig` from the `value_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `dataset` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `variable` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `idvar` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `qeval` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: The following variables have derivation ids not found in the derivations table:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ASTDT, ASTTM, ASTDTM, AENDT, AENTM, AENDTM, AFTRTSTC, ALTRTSTC, APFTRSTC,</span></span>
<span><span class="co">#&gt;   ASTDT, AFTRTST, AFTRTSTC, ALTRTST, ALTRTSTC, ASTDT, ASTTM, ASTDTM, AENDT,</span></span>
<span><span class="co">#&gt;   AENTM, AENDTM, CMBASE, CMBASECD, DOSCUMA, AVISIT, ATPT, ADT, ATM, ADTM,</span></span>
<span><span class="co">#&gt;   APERADY, APERSTDY, APERENDY, ADT, ATM, ADTM, ADT, ATM, ADTM</span></span>
<span><span class="co">#&gt; Warning: The following derivations are never used:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> pred.AE.STUDYID, pred.AE.USUBJID, pred.AE.SUBJID, pred.ADSL.SITEID,</span></span>
<span><span class="co">#&gt;   pred.ADSL.AGE, pred.ADSL.SEX, pred.ADSL.RACE, pred.ADSL.ACOUNTRY,</span></span>
<span><span class="co">#&gt;   pred.ADSL.FASFL, pred.ADSL.ITTFL, pred.ADSL.SAFFL, pred.ADSL.PPROTFL,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TRTxxPN that corresponds to the treatment selected in TRTP,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TRTxxAN that corresponds to the treatment selected in TRTA,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TRT01A, pred.ADSL.TRT01AN, pred.ADSL.TRT01P, pred.ADSL.TRT01PN,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TRTSEQP, pred.ADSL.TRTSEQPN, pred.ADSL.TRTSEQA, pred.ADSL.TRTSEQAN,</span></span>
<span><span class="co">#&gt;   pred.AE.AESTDY, pred.AE.AESTDTC, pred.AE.AEENDTC, pred.AE.AEENDY,</span></span>
<span><span class="co">#&gt;   pred.AE.AESEQ, pred.AE.AETERM, pred.AE.AEMODIFY, pred.AE.AEDECOD,</span></span>
<span><span class="co">#&gt;   pred.AE.AEBODSYS, pred.AE.AEBDSYCD, pred.AE.AELLT, pred.AE.AELLTCD,</span></span>
<span><span class="co">#&gt;   pred.AE.AEPTCD, pred.AE.AEHLT, pred.AE.AEHLTCD, pred.AE.AEHLGT,</span></span>
<span><span class="co">#&gt;   pred.AE.AEHLGTCD, pred.AE.AESOC, pred.AE.AESOCCD, pred.AE.AEDUR,</span></span>
<span><span class="co">#&gt;   pred.AE.AESEV, pred.AE.AESEV or as per RAP, pred.AE.AEACN, pred.SUPPAE.QVAL</span></span>
<span><span class="co">#&gt;   where SUPPAE.QNAM="ACT1", pred.SUPPAE.QVAL where QNAM="AETRTEM",</span></span>
<span><span class="co">#&gt;   pred.AE.AEREFID, pred.AE.AEACNOTH, pred.AE.AESER, pred.AE.AESCAN,</span></span>
<span><span class="co">#&gt;   pred.AE.AESCONG, pred.AE.AESDISAB, pred.AE.AESDTH, pred.AE.AESHOSP,</span></span>
<span><span class="co">#&gt;   pred.AE.AESLIFE, pred.AE.AESOD, pred.AE.AESMIE, pred.SUPPAE.QVAL where</span></span>
<span><span class="co">#&gt;   QNAM="AESPROT", pred.AE.AEOUT, pred.AE.AEREL, pred.AE.AETOXGR, pred.Numeric</span></span>
<span><span class="co">#&gt;   version of AETOXGR, pred.SUPPAE.QVAL where SUPPAE.QNAM="GRADED",</span></span>
<span><span class="co">#&gt;   pred.SUPPAE.QVAL where SUPPAE.QNAM="AEDLT", pred.SUPPAE.QVAL where</span></span>
<span><span class="co">#&gt;   SUPPAE.QNAM="AERDG1", pred.xx.STUDYID, pred.xx.USUBJID, pred.ADSL.SUBJID,</span></span>
<span><span class="co">#&gt;   pred.ADSL.AGEU, pred.ADSL.SAFFL if needed, pred.ADSL.FASFL if needed,</span></span>
<span><span class="co">#&gt;   pred.ADSL.ITTFL if needed, pred.ADSL.ITTEFL if required, pred.ADSL.PPROTFL if</span></span>
<span><span class="co">#&gt;   needed, pred.ADSL.TRTSDT, pred.ADSL.TRTEDT, pred.ADSL.TR01SDT,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TR01EDT, pred.CE.CESEQ, pred.CE.CEREFID, pred.CE.CETERM,</span></span>
<span><span class="co">#&gt;   pred.Study-specific definition, pred.CE.CNDPREV, pred.CE.CESTDTC,</span></span>
<span><span class="co">#&gt;   pred.ADSL.DTHFL, pred.ADSL.DTHFN, pred.ADSL.DTHDT, pred.Cause of Death.,</span></span>
<span><span class="co">#&gt;   pred.CM.STUDYID, pred.CM.USUBJID, pred.CM.SUBJID, pred.CM.CMSTDTC,</span></span>
<span><span class="co">#&gt;   pred.CM.CMSTRF, pred.CM.CMENDTC, pred.CM.CMENRF, pred.CM.CMSEQ,</span></span>
<span><span class="co">#&gt;   pred.CM.CMREFID, pred.CM.CMTRT, pred.CM.CMCAT, pred.CM.CMSCAT,</span></span>
<span><span class="co">#&gt;   pred.CM.CMINDC, pred.CM.CMDOSE, pred.CM.CMDOSTXT, pred.CM.CMDOSU,</span></span>
<span><span class="co">#&gt;   pred.CM.CMDOSFRQ, pred.CM.CMROUTE, pred.CM.CMPRESP, pred.CM.CMCLAS,</span></span>
<span><span class="co">#&gt;   pred.CM.CMCLASCD, pred.GSKDRUG.CMATC1 where GSKDRUG.CMDRGCOL = CM.DRGCOLCD</span></span>
<span><span class="co">#&gt;   and GSKDRUG.CMNC = 'C', pred.GSKDRUG.CMATC2 where GSKDRUG.CMDRGCOL =</span></span>
<span><span class="co">#&gt;   CM.DRGCOLCD and GSKDRUG.CMNC = 'C', pred.GSKDRUG.CMATC3 where</span></span>
<span><span class="co">#&gt;   GSKDRUG.CMDRGCOL = CM.DRGCOLCD and GSKDRUG.CMNC = 'C', pred.GSKDRUG.CMATC4</span></span>
<span><span class="co">#&gt;   where GSKDRUG.CMDRGCOL = CM.DRGCOLCD and GSKDRUG.CMNC = 'C', pred.CM.CMDUR,</span></span>
<span><span class="co">#&gt;   pred.CM.CMOCCUR, pred.CM.CMDOSFRM, pred.DA.STUDYID, pred.DA.USUBJID,</span></span>
<span><span class="co">#&gt;   pred.DA.SUBJID, pred.DA.VISITNUM, pred.DA.VISIT, pred.DA.DACAT,</span></span>
<span><span class="co">#&gt;   pred.DA.DASCAT, pred.DA.DASEQ, pred.DA.DADTC, pred.DA.DADY, pred.DA.DATEST</span></span>
<span><span class="co">#&gt;   and/or derived. Example contains "Compliance %", pred.DA.DATESTCD and/or</span></span>
<span><span class="co">#&gt;   derived, pred.ADSL.STUDYID, pred.ADSL.USUBJID, pred.FAAE.SUBJID,</span></span>
<span><span class="co">#&gt;   pred.FAAE.FATPTREF, pred.FAAE.FATPTNUM, pred.FAAE.FATPT, pred.DD.STUDYID,</span></span>
<span><span class="co">#&gt;   pred.DD.USUBJID, pred.ADSL.ACTARM, pred.ADSL.ENRLFL, pred.ADSL.AP01SDT,</span></span>
<span><span class="co">#&gt;   pred.ADSL.AP01SDTM, pred.ADSL.AP01EDT, pred.ADSL.AP01EDTM, pred.DD.DDTPTREF,</span></span>
<span><span class="co">#&gt;   pred.DD.DDTPTNUM, pred.DD.DDTPT, pred.DS.STUDYID, pred.DS.USUBJID,</span></span>
<span><span class="co">#&gt;   pred.DS.SUBJID, pred.DS.DSSTDTC, pred.DS.DSSEQ, pred.DM.STUDYID,</span></span>
<span><span class="co">#&gt;   pred.DM.USUBJID, pred.DQ.SUBJID, pred.SUPPDM.QVAL when QNAM=RACEOR or</span></span>
<span><span class="co">#&gt;   QNAM=RACEORx where x=1,2, ..., n., pred.ADSL.ARACE, pred.ADSL.ARACEN,</span></span>
<span><span class="co">#&gt;   pred.ADSL.INVID, pred.ADSL.INVNAM, pred.ADSL.COUNTRY, pred.ADSL.AGEGR1,</span></span>
<span><span class="co">#&gt;   pred.ADSL.AGEGR1N, pred.ADSL.RACEN, pred.ADSL.ETHNIC, pred.ADSL.ETHNICN,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TOTFL, pred.ADSL.TOTFN, pred.ADSL.ITTFN, pred.ADSL.PPROTFN,</span></span>
<span><span class="co">#&gt;   pred.ADSL.COMPLFL, pred.ADSL.COMPLFN, pred.ADSL.RUNFFL, pred.ADSL.RUNFFN,</span></span>
<span><span class="co">#&gt;   pred.ADSL.SCRFFL, pred.ADSL.SCRFFN, pred.ADSL.ARM, pred.ADSL.ARMCD,</span></span>
<span><span class="co">#&gt;   pred.ADSL.TRTxxP, where xx is the value for APERIOD, pred.ADSL.TRTxxA, where</span></span>
<span><span class="co">#&gt;   xx is the value for APERIOD, pred.ADSL.RANDDT, pred.ADSL.RFSTDT,</span></span>
<span><span class="co">#&gt;   pred.ADSL.RFENDT, pred.ADSL.APxxSDT, where xx is the value for APERIOD,</span></span>
<span><span class="co">#&gt;   pred.ADSL.APxxEDT, where xx is the value for APERIOD</span></span>
<span><span class="co">#&gt; Warning: The following variables have code ids not found in the codelist(s):</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ADAE.ASTDT, ADAE.ASTTM, ADAE.ASTDTM, ADAE.AENDT, ADAE.AENTM, ADAE.AENDTM,</span></span>
<span><span class="co">#&gt;   ADAE.AESTDTC, ADAE.AEENDTC, ADAE.AEDECOD, ADAE.AEBODSYS, ADAE.AEBDSYCD,</span></span>
<span><span class="co">#&gt;   ADAE.AELLT, ADAE.AELLTCD, ADAE.AEPTCD, ADAE.AEHLT, ADAE.AEHLTCD, ADAE.AEHLGT,</span></span>
<span><span class="co">#&gt;   ADAE.AEHLGTCD, ADAE.AESOC, ADAE.AESOCCD, ADAE.AEDUR, ADAE.ASEVN, ADAE.AEOUTN,</span></span>
<span><span class="co">#&gt;   ADAE.AETOXGR, ADAE.AETOXGRN, ADCE.TRTSDT, ADCE.TRTEDT, ADCE.TR01SDT,</span></span>
<span><span class="co">#&gt;   ADCE.TR01EDT, ADCE.ASTDT, ADCE.DTHDT, ADCM.TPERIOD, ADCM.TPERIODC,</span></span>
<span><span class="co">#&gt;   ADCM.ASTDT, ADCM.ASTTM, ADCM.ASTDTM, ADCM.AENDT, ADCM.AENTM, ADCM.AENDTM,</span></span>
<span><span class="co">#&gt;   ADCM.CMDUR, ADCOMP.ADT, ADCOMP.ATM, ADCOMP.ADTM, ADCOMP.PARAMCD, ADCOVID.ADT,</span></span>
<span><span class="co">#&gt;   ADCOVID.ATM, ADCOVID.ADTM, ADCOVID.AENDT, ADCOVID.ASTDT, ADDD.AP01SDT,</span></span>
<span><span class="co">#&gt;   ADDD.AP01SDTM, ADDD.AP01EDT, ADDD.AP01EDTM, ADDD.ADT, ADDS.ADT, ADDS.ATM,</span></span>
<span><span class="co">#&gt;   ADDS.ADTM, ADDS.PARCAT1, ADDS.PARCAT1N, ADDS.PARAM, ADDS.PARAMCD,</span></span>
<span><span class="co">#&gt;   ADRACE.RACEORCD, ADRACE.ARACE, ADTRT.ETHNIC</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Metadata successfully imported</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> To use the Metacore object with <span style="color: #0000BB;">metatools</span> package, first subset a dataset</span></span>
<span><span class="co">#&gt;   using `metacore::select_dataset()`</span></span>
<span><span class="co">#&gt; ── Metacore object contains metadata for 4 datasets ────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; → ADDS (Disposition Analysis)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; → ADRACE (Race Analysis)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; → ADTRT (Treatment Analysis)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; → ADSL (Subject-Level Analysis Dataset)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To use the Metacore object with <span style="color: #0000BB;">metatools</span> package, first subset a dataset using</span></span>
<span><span class="co">#&gt; `metacore::select_dataset()`</span></span></code></pre></div>
<p>And we’re good to go!</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Liam Hobby, Christina Fillmore, Bill Denney, Maya Gans, Ashley Tarasiewicz, Mike Stackhouse, Tamara Senior, GSK/Atorus JPT.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
