<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example • metacore</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metacore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Building_Specification_Readers.html">Building Specification Readers</a>
    </li>
    <li>
      <a href="../articles/Example.html">Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atorus-research/metacore/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atorus-research/metacore/blob/0.2.1/vignettes/Example.Rmd" class="external-link"><code>vignettes/Example.Rmd</code></a></small>
      <div class="hidden name"><code>Example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atorus-research.github.io/metacore/" class="external-link">metacore</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org" class="external-link">xml2</a></span><span class="op">)</span></span></code></pre></div>
<p><a href="https://www.cdisc.org/" class="external-link">CDISC</a> standards provide a
standard for submission of data set metadata through a document known as
define.xml. The define provides a great deal of useful information that
is both machine readable and can be viewed through your web browser.
While many organizations wait to produce a define until the datasets are
finalized, it can still be advantageous to be able to read metadata
directly from a define. For this purpose, we developed readers that can
go directly from a define.xml to a metacore object.</p>
<p>To do this, we’ve built separate reader function for each of the
metacore tables. For more information on the structure of the metacore
tables, check out the README.</p>
<p>We start by reading the define from disk using the
<code>xmlTreeParse()</code> function from the <code>XML</code>
package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_xml</a></span><span class="op">(</span><span class="fu"><a href="../reference/metacore_example.html">metacore_example</a></span><span class="op">(</span><span class="st">"SDTM_define.xml"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_ns_strip.html" class="external-link">xml_ns_strip</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span></code></pre></div>
<p>Next, we use the metacore readers for each of the separate tables
necessary for a metacore object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_spec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_ds_spec.html">xml_to_ds_spec</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">ds_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_ds_vars.html">xml_to_ds_vars</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">var_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_var_spec.html">xml_to_var_spec</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">value_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_value_spec.html">xml_to_value_spec</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">code_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_codelist.html">xml_to_codelist</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">derivations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xml_to_derivations.html">xml_to_derivations</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span></span></code></pre></div>
<p>Great! Now we’re ready to create our metacore object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metacore.html">metacore</a></span><span class="op">(</span><span class="va">ds_spec2</span>, <span class="va">ds_vars</span>, <span class="va">var_spec</span>, <span class="va">value_spec</span>, <span class="va">derivations</span>, <span class="va">code_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The following word in value_spec$origin is not allowed:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> edt</span></span>
<span><span class="co">#&gt; Warning: `core` from the `ds_vars` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `supp_flag` from the `ds_vars` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `common` from the `var_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `dataset` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `variable` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `idvar` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `qeval` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: The following derivations are never used:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> MT.SUPPAE.QVAL MT.SUPPDM.QVAL</span></span>
<span><span class="co">#&gt; Warning: The following codelists are never used:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> DRUG DICTIONARY MEDICAL HISTORY DICTIONARY</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Metadata successfully imported</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> To use the Metacore object with <span style="color: #0000BB;">metatools</span> package, first subset a dataset</span></span>
<span><span class="co">#&gt;   using `metacore::select_dataset()`</span></span></code></pre></div>
<p>Something to note about a metacore object is that it inherently holds
all data from your source of metadata, be it your specification,
define.xml, database, etc. So that means you have <em>all</em> the
metadata. In your program, it’s likely that you’ll just want to keep
metadata relevant to the dataset you’re currently programming. We’ve
made process easily, with functions that filter metadata down to
information only relevant to a specific dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a metacore object with all your dataframes</span></span>
<span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/select_dataset.html">select_dataset</a></span><span class="op">(</span><span class="st">"DM"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `core` from the `ds_vars` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `supp_flag` from the `ds_vars` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `format` from the `var_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `common` from the `var_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `sig_dig` from the `value_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `where` from the `value_spec` table only contains missing</span></span>
<span><span class="co">#&gt; values.</span></span>
<span><span class="co">#&gt; Warning: `dataset` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `variable` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `idvar` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; Warning: `qeval` from the `supp` table only contains missing values.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> DM dataset successfully selected</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">subset</span><span class="op">$</span><span class="va">ds_spec</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   dataset structure              label       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> DM      One record per subject Demographics</span></span>
<span></span>
<span><span class="co"># a simplified dataframe </span></span>
<span><span class="va">subset_t</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/select_dataset.html">select_dataset</a></span><span class="op">(</span><span class="st">"DM"</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>As can be seen above, the metacore object can be filtered directly,
or by using the <code>simplify = TRUE</code> argument, a simplified data
frame can be returned.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_t</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 21</span></span></span>
<span><span class="co">#&gt;    dataset variable key_seq order keep  core  supp_flag type     length label   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DM      STUDYID        1     1 TRUE  <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        text         12 Study I…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> DM      DOMAIN        <span style="color: #BB0000;">NA</span>     2 TRUE  <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        text          2 Domain …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> DM      USUBJID        2     3 TRUE  <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        text         11 Unique …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> DM      SUBJID        <span style="color: #BB0000;">NA</span>     4 TRUE  <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        text          4 Subject…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DM      RFSTDTC       <span style="color: #BB0000;">NA</span>     5 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        date         10 Subject…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> DM      RFENDTC       <span style="color: #BB0000;">NA</span>     6 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        date         10 Subject…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> DM      RFXSTDTC      <span style="color: #BB0000;">NA</span>     7 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        datetime     20 Date/Ti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> DM      RFXENDTC      <span style="color: #BB0000;">NA</span>     8 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        datetime     20 Date/Ti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> DM      RFICDTC       <span style="color: #BB0000;">NA</span>     9 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        datetime     20 Date/Ti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DM      RFPENDTC      <span style="color: #BB0000;">NA</span>    10 FALSE <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        datetime     20 Date/Ti…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 11 more variables: format &lt;chr&gt;, common &lt;lgl&gt;, code_id &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   derivation_id &lt;chr&gt;, origin &lt;chr&gt;, where &lt;chr&gt;, sig_dig &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   derivation &lt;chr&gt;, codes &lt;list&gt;, idvar &lt;chr&gt;, qeval &lt;chr&gt;</span></span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Liam Hobby, Christina Fillmore, Bill Denney, Maya Gans, Ashley Tarasiewicz, Mike Stackhouse, Tamara Senior, GSK/Atorus JPT.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
